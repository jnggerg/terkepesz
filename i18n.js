const LOCALE_HU = {
    "missions": {
        "forest_edge":{
            "title": "Az erdÅ‘ szÃ©le",
            "description": "A tÃ©rkÃ©ped szÃ©lÃ©vel szomszÃ©dos erdÅ‘mezÅ‘idÃ©rt egy-egy pontot kapsz."
        },
        "dream_valley": {
            "title": "Ãlmos-vÃ¶lgy",
            "description": "Minden olyan sorÃ©rt, amelyben hÃ¡rom erdÅ‘mezÅ‘ van, nÃ©gy-nÃ©gy pontot kapsz."
        },
        "potato_watering": {
            "title": "KrumpliÃ¶ntÃ¶zÃ©s",
            "description": "A farmmezÅ‘iddel szomszÃ©dos vÃ­zmezÅ‘idÃ©rt kÃ©t-kÃ©t pontot kapsz."
        },
        "border_region": {
            "title": "HatÃ¡rvidÃ©k",
            "description": "Minden teli sorÃ©rt vagy oszlopÃ©rt 6-6 pontot kapsz."
        }
    },
    "ui": {
        "title": "TÃ©rkÃ©pÃ©sz",
        "restart": "JÃ¡tÃ©k ÃºjraindÃ­tÃ¡sa",
        "help": "SegÃ­tsÃ©g",
        "timeLeft": "HÃ¡tralevÅ‘ idÅ‘:",
        "totalPoints": "Ã–sszes pontszÃ¡m:",
        "points": "pont",
        "spring": "Tavasz",
        "summer": "NyÃ¡r",
        "autumn": "Åsz",
        "winter": "TÃ©l",
        "rotate": "ForgatÃ¡s",
        "mirror": "TÃ¼krÃ¶zÃ©s",
        "timeValue": "IdÅ‘Ã©rtÃ©k",
        "gameOver": "VÃ©ge",
        "gameOverDesc": "A jÃ¡tÃ©knak vÃ©ge! Ha Ãºj jÃ¡tÃ©kot kezdenÃ©l, nyomj az 'ÃšjraindÃ­tÃ¡s' gombra!",
        "ok": "Ok",
        "lang": "ðŸ‡­ðŸ‡º"
    },
    "help": {
        "gameplay": "JÃ¡tÃ©kmenet",
        "gameplayDesc": "A jÃ¡tÃ©k cÃ©lja, hogy a lehetÅ‘ legtÃ¶bb pontot gyÅ±jtsd Ã¶ssze a rendelkezÃ©sedre Ã¡llÃ³ idÅ‘ alatt. Ehhez kÃ¼lÃ¶nbÃ¶zÅ‘ tÃ©rkÃ©pelemeket helyezhetsz el a jÃ¡tÃ©ktÃ¡blÃ¡n, amelyek kÃ¼lÃ¶nbÃ¶zÅ‘ Ã©vszakokhoz tartoznak. Minden Ã©vszakhoz tartozik egy kÃ¼ldetÃ©slista, amely megmutatja, hogy mely elemek elhelyezÃ©sÃ©vel szerezhetsz pontokat.",
        "controls": "VezÃ©rlÃ©s",
        "rotate": "Elem forgatÃ¡sa:",
        "rotateDesc": "Kattints a 'ForgatÃ¡s' gombra az aktuÃ¡lis elem elforgatÃ¡sÃ¡hoz.",
        "mirror": "Elem tÃ¼krÃ¶zÃ©se:",
        "mirrorDesc": "Kattints a 'TÃ¼krÃ¶zÃ©s' gombra az aktuÃ¡lis elem tÃ¼krÃ¶zÃ©sÃ©hez.",
        "place": "Elem elhelyezÃ©se:",
        "placeDesc": "Kattints a jÃ¡tÃ©ktÃ¡bla egy Ã¼res mezÅ‘jÃ©re az aktuÃ¡lis elem elhelyezÃ©sÃ©hez.",
        "scoring": "PontszÃ¡mÃ­tÃ¡s",
        "scoringDesc": "Minden elhelyezett elem pontokat Ã©r az adott Ã©vszak kÃ¼ldetÃ©sei alapjÃ¡n. Az Ã¶sszesÃ­tett pontszÃ¡mot a kÃ©pernyÅ‘ jobb oldalÃ¡n lÃ¡thatod.",
        "timeManagement": "IdÅ‘kezelÃ©s",
        "timeManagementDesc1": "A jÃ¡tÃ©k egy idÅ‘zÃ­tÅ‘vel rendelkezik, amely mutatja a hÃ¡tralevÅ‘ idÅ‘t. Az idÅ‘ lejÃ¡rta utÃ¡n a jÃ¡tÃ©k vÃ©get Ã©r, Ã©s megjelenik a vÃ©gsÅ‘ pontszÃ¡mod.",
        "timeManagementDesc2": "Az idÅ‘ valÃ³jÃ¡ban a lerakhatÃ³ elemek szÃ¡mÃ¡t jelzi, minden elemnÃ©l lÃ¡thatÃ³ a jobb oldalon az idÅ‘Ã©rtÃ©ke."
    }
};
const LOCALE_EN = {
    "missions": {
        "forest_edge":{
            "title": "Forest Edge",
            "description": "You gain one point for each forest tile adjacent to the edge of your map."
        },
        "dream_valley": {
            "title": "Dream-Valley",
            "description": "For every row, in which there are three forest tiles, you gain four points."
        },
        "potato_watering": {
            "title": "Potato Watering",
            "description": "You gain two points for each water tile adjacent to your farm tiles."
        },
        "border_region": {
            "title": "Border Region",
            "description": "You gain six points for each filled row or column."
        }
    },
    "ui": {
        "title": "Cartographer",
        "restart": "Restart Game",
        "help": "Help",
        "timeLeft": "Time Left:",
        "totalPoints": "Total Points:",
        "points": "points",
        "spring": "Spring",
        "summer": "Summer",
        "autumn": "Autumn",
        "winter": "Winter",
        "rotate": "Rotate",
        "mirror": "Mirror",
        "timeValue": "Time Value",
        "gameOver": "Game Over",
        "gameOverDesc": "The game is over! If you want to play again, press the 'Restart Game' button!",
        "ok": "Ok",
        "lang": "ðŸ‡¬ðŸ‡§"
    },
    "help": {
        "gameplay": "Gameplay",
        "gameplayDesc": "The goal of the game is to collect as many points as possible during the available time. To do this, you can place various map elements on the game board that belong to different seasons. Each season has a mission list that shows which elements you can place to earn points.",
        "controls": "Controls",
        "rotate": "Rotate Element:",
        "rotateDesc": "Click the 'Rotate' button to rotate the current element.",
        "mirror": "Mirror Element:",
        "mirrorDesc": "Click the 'Mirror' button to mirror the current element.",
        "place": "Place Element:",
        "placeDesc": "Click on an empty field on the game board to place the current element.",
        "scoring": "Scoring",
        "scoringDesc": "Each placed element earns points based on the current season's missions. You can see the total score on the right side of the screen.",
        "timeManagement": "Time Management",
        "timeManagementDesc1": "The game has a timer that shows the remaining time. After the time runs out, the game ends and your final score is displayed.",
        "timeManagementDesc2": "Time actually represents the number of elements that can be placed. Each element shows its time value on the right side."
    }
};

let currentLang = localStorage.getItem('lang') || 'hu';

function applyTranslations() {
    document.querySelectorAll("[data-i18n]").forEach(elem => {
        const key = elem.getAttribute("data-i18n");
        elem.textContent = t(key);
    });
}

function setLanguage(lang) {
    currentLang = lang;
    localStorage.setItem("lang", lang);
    applyTranslations();
}

function toggleLanguage() {
    const flag = currentLang === 'hu' ? 'ðŸ‡¬ðŸ‡§' : 'ðŸ‡­ðŸ‡º';
    document.getElementById('lang-toggle').textContent = flag;
    const newLang = currentLang === 'hu' ? 'en' : 'hu';
    setLanguage(newLang);
    // refresh missions for proper translation
    if (gameState && gameState.missions) {
        initializeMissions(true);
        
        //reapplying selected class to current seasons missions
        const seasonMissions = getSeasonMissions(gameState.currentSeason);
        for (let i = 0; i < seasonMissions.length; i++) {
            const seasonMission = seasonMissions[i];
            const seasonMissionHtml = document.getElementById(`${seasonMission.id}${SEASON_MISSION_SUFFIX}`);
            seasonMissionHtml?.classList.add('selected');
        }
        
        updateSeasonPoints(SPRING);
        updateSeasonPoints(SUMMER);
        updateSeasonPoints(AUTUMN);
        updateSeasonPoints(WINTER);
    }
}
document.addEventListener("DOMContentLoaded", () => {
    applyTranslations();
});

const translations = {
    "en": LOCALE_EN,
    "hu": LOCALE_HU
}

function t(key) {
    const locale = translations[currentLang];
    const keys = key.split('.');
    let value = locale;
    for (let k of keys) {
        value = value[k];
        if (!value) return key;
    }
    return value;
}

function getMissionTitle(missionId) {
    const missions = {
        'forest_edge': t('missions.forest_edge.title'),
        'dream_valley': t('missions.dream_valley.title'),
        'potato_watering': t('missions.potato_watering.title'),
        'border_region': t('missions.border_region.title')
    };
    return missions[missionId] || missionId;
}

function getMissionDescription(missionId) {
    const missions = {
        'forest_edge': t('missions.forest_edge.description'),
        'dream_valley': t('missions.dream_valley.description'),
        'potato_watering': t('missions.potato_watering.description'),
        'border_region': t('missions.border_region.description')
    };
    return missions[missionId] || missionId;
}